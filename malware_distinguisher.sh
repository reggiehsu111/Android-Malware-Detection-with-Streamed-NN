cuckoopath="$HOME/cuckoo"
sudo python $cuckoopath/cuckoo.py -d &
sleep 10
for(( ; ; ))
#for APK in $HOME/Ransomware/*.apk
do
	echo "APK File Directory?"
#	echo $APK
	read APK
	echo ""
	echo "Run static"
	echo ""
	python3 static_evaluate.py $APK
	while IFS='' read -r line || [[ -n "$line" ]]; do
		type=$line
	done < "tmp"
	rm tmp
	echo ""
	if [ "$type" != "Benign" ];
	then
		echo "The APK file is considered $type"
		echo ""
	fi
	if [ "$type" = "Benign" ];
	then
		echo "The APK file is considered $type"
		echo "Run cuckoo"
		echo ""
	
		sudo python $cuckoopath/utils/submit.py $APK
		sleep 30
		tem="$cuckoopath/storage/analyses/"
		temlen=${#tem}
		for filename in $cuckoopath/storage/analyses/*/
		do
			if [ "$filename" == "$cuckoopath/storage/analyses/latest/" ]
			then
				continue
			fi
			filelen=${#filename} 
			if [ $temlen -lt $filelen ] 
			then
				tem=$filename
				temlen=$filelen
			else 
				if [ $temlen -eq $filelen ] && [ $tem < $filename ]
				then
					tem=$filename
					temlen=$filelen
				fi
			fi
		
		done
		result=$tem
		for(( ; ; ))
		do
			sleep 5
			if [ -f "$result/reports/report.html" ]
			then
				break
			fi
		done
		sudo cp $APK $result
		echo ""
		echo "Run network at $result"
		echo ""
		python3 dynamic_predict.py $result
		echo ""
		echo "=================================="
		echo ""
	fi
done 
